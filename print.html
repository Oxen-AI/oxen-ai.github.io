<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Oxen</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="init.html">üêÇ üåæ Oxen.ai</a></li><li class="chapter-item expanded "><a href="development.html"><strong aria-hidden="true">1.</strong> Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="development/installation.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="development/build_and_run.html"><strong aria-hidden="true">1.2.</strong> Build & Run</a></li><li class="chapter-item expanded "><a href="development/add_command.html"><strong aria-hidden="true">1.3.</strong> Adding a Command</a></li><li class="chapter-item expanded "><a href="development/testing.html"><strong aria-hidden="true">1.4.</strong> Testing</a></li><li class="chapter-item expanded "><a href="development/release.html"><strong aria-hidden="true">1.5.</strong> Release</a></li></ol></li><li class="chapter-item expanded "><a href="domains.html"><strong aria-hidden="true">2.</strong> Domains</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="domains/repositories.html"><strong aria-hidden="true">2.1.</strong> Repositories</a></li><li class="chapter-item expanded "><a href="domains/commits.html"><strong aria-hidden="true">2.2.</strong> Commits</a></li><li class="chapter-item expanded "><a href="domains/user.html"><strong aria-hidden="true">2.3.</strong> User</a></li><li class="chapter-item expanded "><a href="domains/branches.html"><strong aria-hidden="true">2.4.</strong> Branches</a></li><li class="chapter-item expanded "><a href="domains/data_frames.html"><strong aria-hidden="true">2.5.</strong> Data Frames</a></li><li class="chapter-item expanded "><a href="domains/schemas.html"><strong aria-hidden="true">2.6.</strong> Schemas</a></li><li class="chapter-item expanded "><a href="domains/diffs.html"><strong aria-hidden="true">2.7.</strong> Diffs</a></li><li class="chapter-item expanded "><a href="domains/remotes.html"><strong aria-hidden="true">2.8.</strong> Remotes</a></li><li class="chapter-item expanded "><a href="domains/namespaces.html"><strong aria-hidden="true">2.9.</strong> Namespaces</a></li></ol></li><li class="chapter-item expanded "><a href="commands.html"><strong aria-hidden="true">3.</strong> Commands</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="commands/init.html"><strong aria-hidden="true">3.1.</strong> init</a></li><li class="chapter-item expanded "><a href="commands/config.html"><strong aria-hidden="true">3.2.</strong> config</a></li><li class="chapter-item expanded "><a href="commands/add.html"><strong aria-hidden="true">3.3.</strong> add</a></li><li class="chapter-item expanded "><a href="commands/status.html"><strong aria-hidden="true">3.4.</strong> status</a></li><li class="chapter-item expanded "><a href="commands/commit.html"><strong aria-hidden="true">3.5.</strong> commit</a></li><li class="chapter-item expanded "><a href="commands/checkout.html"><strong aria-hidden="true">3.6.</strong> checkout</a></li><li class="chapter-item expanded "><a href="commands/push.html"><strong aria-hidden="true">3.7.</strong> push</a></li><li class="chapter-item expanded "><a href="commands/clone.html"><strong aria-hidden="true">3.8.</strong> clone</a></li><li class="chapter-item expanded "><a href="commands/pull.html"><strong aria-hidden="true">3.9.</strong> pull</a></li></ol></li><li class="chapter-item expanded "><a href="data_types.html"><strong aria-hidden="true">4.</strong> Data Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="data_types/text.html"><strong aria-hidden="true">4.1.</strong> Text</a></li><li class="chapter-item expanded "><a href="data_types/image.html"><strong aria-hidden="true">4.2.</strong> Image</a></li><li class="chapter-item expanded "><a href="data_types/audio.html"><strong aria-hidden="true">4.3.</strong> Audio</a></li><li class="chapter-item expanded "><a href="data_types/video.html"><strong aria-hidden="true">4.4.</strong> Video</a></li><li class="chapter-item expanded "><a href="data_types/tabular.html"><strong aria-hidden="true">4.5.</strong> Tabular</a></li><li class="chapter-item expanded "><a href="data_types/binary.html"><strong aria-hidden="true">4.6.</strong> Binary</a></li></ol></li><li class="chapter-item expanded "><a href="optimizations.html"><strong aria-hidden="true">5.</strong> Optimizations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="optimizations/merkle_tree.html"><strong aria-hidden="true">5.1.</strong> Merkle Tree</a></li><li class="chapter-item expanded "><a href="optimizations/concurrency.html"><strong aria-hidden="true">5.2.</strong> Concurrency</a></li><li class="chapter-item expanded "><a href="optimizations/hashing.html"><strong aria-hidden="true">5.3.</strong> Hashing</a></li><li class="chapter-item expanded "><a href="optimizations/compression.html"><strong aria-hidden="true">5.4.</strong> Compression</a></li><li class="chapter-item expanded "><a href="optimizations/networking.html"><strong aria-hidden="true">5.5.</strong> Networking</a></li><li class="chapter-item expanded "><a href="optimizations/remote_workspace.html"><strong aria-hidden="true">5.6.</strong> Remote Workspace</a></li><li class="chapter-item expanded "><a href="optimizations/storage.html"><strong aria-hidden="true">5.7.</strong> Storage</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Oxen</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="--oxenai"><a class="header" href="#--oxenai">üêÇ üåæ Oxen.ai</a></h1>
<p>Welcome to the Herd! This is a whirlwind tour of the Oxen.ai codebase. This is an evolving artifact meant to document the tool and codebase.</p>
<p>Each section dives into a different part of the code base as well as the file formats on disk. It is a resource for engineers who want to contribute or extend the tooling, or simply want to learn the inner workings.</p>
<h1 id="what-is-oxen"><a class="header" href="#what-is-oxen">What is Oxen?</a></h1>
<p>Oxen at it's core is a blazing fast data version control tool written in Rust. It is optimized for large machine learning datasets. These datasets could consist of many small files (think an images/ folder for computer vision tasks), a few large files (a collection of timeseries datasets as csvs), or many large files (an LLM pre-training dataset of parquet files).</p>
<p>In the <a href="https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control">Git Book</a> they define "Version Control" as "a system that records changes to a file or set of files over time so that you can recall specific versions later." As a software engineer we typically use tools such as <code>git</code> to version our source code. This allows us to keep every single version of a file so that we can revert back to a previous state and compare changes over time. While <code>git</code> is great for versioning smaller assets such as files in a code base, it struggles to version large datasets.</p>
<h1 id="why-build-oxen"><a class="header" href="#why-build-oxen">Why build Oxen?</a></h1>
<p>As machine learning engineers, we were frustrated with the speed of managing and iterating on datasets that traditionally would not fit well into <code>git</code>. There are extensions to <code>git</code> such as <code>git-lfs</code> but they are like fitting a square peg in a round hole and come with their own issues.</p>
<p>Data versions should be easy to interact with locally, fast to sync to a remote, seamless contribute to, and feel like you have terrabytes accessible at your fingertips by slicing and downloading subsets locally when you need it.</p>
<h1 id="why-write-this-book"><a class="header" href="#why-write-this-book">Why write this book?</a></h1>
<p>"What I cannot create, I do not understand". - Richard Feynman</p>
<p>When it comes to open source contribution and scaling up a software project this is true as well. This book is for developers to get an understanding of the internals, design decisions, and places for improvement in the Oxen.ai code base. Open source is meant to not only be open, but understandable. This is an evolving artifact meant to document the tool and codebase.</p>
<h1 id="why-is-oxen-fast"><a class="header" href="#why-is-oxen-fast">Why is Oxen fast?</a></h1>
<p>This is always one of the first questions we get. The simple answer is that there are  There are many <a href="./optimizations.html">optimizations</a> that make Oxen fast. Many are just fundamental computer science concepts but when stacked together make a nice developer experience for iterating on datasets.</p>
<h1 id="why-the-name-oxen"><a class="header" href="#why-the-name-oxen">Why the name Oxen?</a></h1>
<p>"Oxen" üêÇ comes from the fact that the tooling will plow, maintain, and version your data like a good farmer tends to their fields üåæ. During the agricultural revolution the Ox allowed humans to automate the process of plowing fields so they could specialize in higher level tasks. Data is the lifeblood of ML/AI. Let Oxen take care of the grunt work of your infrastructure so you can focus on the higher-level problems that matter to your product.</p>
<h1 id="where-to-start"><a class="header" href="#where-to-start">Where to start?</a></h1>
<p>In order to fully grok the Oxen codebase, it's important to define a few terms and understand the different <a href="domains.html">domain objects</a>. This way you'll have the right terminology to build upon and know where to look when adding or debugging features.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="development"><a class="header" href="#development">Development</a></h1>
<p>If you are interested in how to install Oxen, how to build from source, or how to release, this section is for you.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="-build--run"><a class="header" href="#-build--run">üî® Build &amp; Run</a></h1>
<h2 id="install-dependencies"><a class="header" href="#install-dependencies">Install Dependencies</a></h2>
<p>Oxen is purely written in Rust ü¶Ä. You should install the Rust toolchain with rustup: https://www.rust-lang.org/tools/install.</p>
<pre><code>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
</code></pre>
<p>If you are a developer and want to learn more about adding code or the overall architecture <a href="development/docs/dev/AddLibraryCode.html">start here</a>. Otherwise a quick start to make sure everything is working follows.</p>
<h2 id="build"><a class="header" href="#build">Build</a></h2>
<p>Simply use <code>cargo</code> within the root directory to build. Cargo looks at <code>Cargo.toml</code> to figure out the dependencies and which binaries to build.</p>
<pre><code>cargo build
</code></pre>
<p>Given all the dependencies, the first build can take quite awhile, feel free to go grab some coffee ‚òïÔ∏è. Don't worry subsequent builds will be faster and we can speed up the linker later.</p>
<h2 id="library-cli-server"><a class="header" href="#library-cli-server">Library, CLI, Server</a></h2>
<p>There are three components that are built during <code>cargo build</code> and they are separated into three directories within the <code>src</code> folder.</p>
<pre><code class="language-bash">ls src
</code></pre>
<pre><code>cli/
lib/
server/
</code></pre>
<p>The library is all the shared code between the CLI and Server. This contains the majority of classes and business logic. The CLI and Server are meant to be thin wrappers over the core oxen library functionality.</p>
<p>The library is also used for the Python client (TODO: Link) which should also remain a thin wrapper.</p>
<h2 id="run"><a class="header" href="#run">Run</a></h2>
<p>While developing, the debug binary will be located at <code>./target/debug/oxen</code>. It is nice to make a symbolic link to your development build to your <code>/usr/local/bin</code> so that you can call the <code>oxen</code> binary from anywhere.</p>
<pre><code class="language-bash">ln -s target/debug/oxen /usr/local/bin/oxen
</code></pre>
<p>Note: If you have previously installed Oxen through homebrew or other methods make sure it is removed from your $PATH. To verify which <code>oxen</code> you are running simply test</p>
<pre><code class="language-bash"># figure out where oxen is installed
which oxen
# to see if it is a symbolic link
ls -al /path/to/oxen
</code></pre>
<h3 id="speed-up-the-build-process"><a class="header" href="#speed-up-the-build-process">Speed up the build process</a></h3>
<p>You can use
the <a href="https://github.com/rui314/mold">mold</a> linker to speed up builds (The
commercial Mac OS version is <a href="https://github.com/bluewhalesystems/sold">sold</a>).</p>
<p>Assuming you have purchased a license, you can use the following instructions to
install sold and configure cargo to use it for building Oxen:</p>
<pre><code>git clone https://github.com/bluewhalesystems/sold.git

mkdir sold/build
cd sold/build
cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_COMPILER=c++ ..
cmake --build . -j $(nproc)
sudo cmake --install .
</code></pre>
<p>Then create <code>.cargo/config.toml</code> in your Oxen repo root with the following
content:</p>
<pre><code>[target.x86_64-unknown-linux-gnu]
rustflags = ["-C", "link-arg=-fuse-ld=/usr/local/bin/ld64.mold"]

[target.x86_64-apple-darwin]
rustflags = ["-C", "link-arg=-fuse-ld=/usr/local/bin/ld64.mold"]

</code></pre>
<p><strong>For macOS with Apple Silicon</strong>, you can use the <a href="https://lld.llvm.org/">lld</a> linker.</p>
<pre><code>brew install llvm
</code></pre>
<p>Then create <code>.cargo/config.toml</code> in your Oxen repo root with the following:</p>
<pre><code>[target.aarch64-apple-darwin]
rustflags = [ "-C", "link-arg=-fuse-ld=/opt/homebrew/opt/llvm/bin/ld64.lld", ]

</code></pre>
<h2 id="run-oxen-server"><a class="header" href="#run-oxen-server">Run Oxen-Server</a></h2>
<p>Generate a config file and token to give user access to the server</p>
<pre><code>./target/debug/oxen-server add-user --email ox@oxen.ai --name Ox --output user_config.toml
</code></pre>
<p>Copy the config to the default locations</p>
<pre><code>mkdir ~/.oxen
</code></pre>
<pre><code>mv user_config.toml ~/.oxen/user_config.toml
</code></pre>
<pre><code>cp ~/.oxen/user_config.toml data/test/config/user_config.toml
</code></pre>
<p>Set where you want the data to be synced to. The default sync directory is <code>./data/</code> to change it set the SYNC_DIR environment variable to a path.</p>
<pre><code>export SYNC_DIR=/path/to/sync/dir
</code></pre>
<p>Run the server</p>
<pre><code>./target/debug/oxen-server start
</code></pre>
<p>To run the server with live reload, first install cargo-watch</p>
<pre><code>cargo install cargo-watch
</code></pre>
<p>Then run the server like this</p>
<pre><code>cargo watch -- cargo run --bin oxen-server start
</code></pre>
<h1 id="unit--integration-tests"><a class="header" href="#unit--integration-tests">Unit &amp; Integration Tests</a></h1>
<p>Make sure your server is running on the default port and host, then run</p>
<p><em>Note:</em> tests open up a lot of file handles, so limit num test threads if running everything.</p>
<p>You an also increase the number of open files your system allows ulimit before running tests:</p>
<pre><code>ulimit -n 10240
</code></pre>
<pre><code>cargo test -- --test-threads=$(nproc)
</code></pre>
<p>It can be faster (in terms of compilation and runtime) to run a specific test. To run a specific library test:</p>
<pre><code>cargo test --lib test_get_metadata_text_readme
</code></pre>
<p>To run a specific integration test</p>
<pre><code>cargo test --test test_rm test_rm_directory_restore_directory
</code></pre>
<p>To run with all debug output and run a specific test</p>
<pre><code>env RUST_LOG=warn,liboxen=debug,integration_test=debug cargo test -- --nocapture test_command_push_clone_pull_push
</code></pre>
<p>To set a different test host you can set the <code>OXEN_TEST_HOST</code> environment variable</p>
<pre><code>env OXEN_TEST_HOST=0.0.0.0:4000 cargo test
</code></pre>
<h1 id="cli-commands"><a class="header" href="#cli-commands">CLI Commands</a></h1>
<p>Now feel free to try out some CLI commands and see the tool in action!</p>
<pre><code>oxen init .
oxen status
oxen add images/
oxen status
oxen commit -m "added images"
oxen create-remote --name ox/wikipedia --host 0.0.0.0:3001 --scheme http
oxen config --set-remote origin http://localhost:3001/ox/wikipedia
oxen push origin main
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-a-command"><a class="header" href="#adding-a-command">Adding a Command</a></h1>
<h2 id="mainrs"><a class="header" href="#mainrs">main.rs</a></h2>
<h2 id="parse_and_runrs"><a class="header" href="#parse_and_runrs">parse_and_run.rs</a></h2>
<h2 id="commands"><a class="header" href="#commands">commands</a></h2>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="domain-objects"><a class="header" href="#domain-objects">Domain Objects</a></h1>
<p>Learning about the different domain objects is a good place to start. These domains are defined so we are all speaking the same language while diving into the code base. Starting from what the objects are, why they exist, and how objects are stored on disk, we will build up intuition of how the system works as a whole.</p>
<h1 id="file-structure"><a class="header" href="#file-structure">File Structure</a></h1>
<p>Similar to <code>git</code>, we store all the meta data for a repository in a hidden local <code>.oxen</code> directory. To start the learning journey let's initialize and empty Oxen repository locally by using <a href="./commands/init.html">oxen init</a>.</p>
<pre><code class="language-bash">mkdir my-repo
cd my-repo
oxen init
</code></pre>
<p>The best way to start learning the architecture and different domain objects is by poking around in this directory.</p>
<pre><code class="language-bash">ls .oxen
</code></pre>
<p>You will see a variety of files and folders, including:</p>
<pre><code>commits/
history/
objects/
refs/
HEAD
config.toml
</code></pre>
<p>Let's use these files and folders as a jumping off point to learn about the different domain objects.</p>
<h1 id="first-up-repositories"><a class="header" href="#first-up-repositories">First Up: Repositories</a></h1>
<p>All of the domain objects exist within the context of a "Repository", so let's <a href="domains/repositories.html">start there</a>. All of the files and folders within the <code>.oxen</code> directory represent different sub components of a Repository, but we need some over arching objects to kick the process all off. These are what we call the <code>LocalRepository</code> and <code>RemoteRepository</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="repositories"><a class="header" href="#repositories">Repositories</a></h1>
<p>When we talk about data in Oxen, we usually talk about "Repositories". A Repository lives within your working directory of data in a hidden <code>.oxen</code> directory. You can think of a Repository as a series of snapshots of your data at any given point in time.</p>
<p><img src="domains//images/versions.png" alt="File Versions" /></p>
<p>Each snapshot contains a "mini filesystem" representing all the files and folders in that snapshot. The each mini filesystem is represented by a <a href="domains/domains/commits.html">commit</a>, and is stored in the <code>.oxen</code> directory so that we can return to it at any point in time.</p>
<p>To see this in action let's instantiate a local oxen repository and see what it looks like.</p>
<pre><code class="language-bash">$ oxen init
$ ls -trla
</code></pre>
<pre><code>total 0
drwxr-xr-x  23 bessie  staff  736 May 22 16:41 ../
drwxr-xr-x   3 bessie  staff   96 May 22 16:41 ./
drwxr-xr-x  10 bessie  staff  320 May 22 16:41 .oxen/
</code></pre>
<p>This magic <code>.oxen</code> directory is what will hold all the snapshots of your data. Think of it as a local database that lets you roll back your data to any point in time.</p>
<p>Let's add and commit some files to the repository and see what happens.</p>
<pre><code class="language-bash">$ echo "Hello" &gt; hello.txt
$ echo "World" &gt; world.txt
$ oxen add hello.txt world.txt
$ oxen commit -m "Add hello.txt and world.txt"
</code></pre>
<p>Each file that gets added and committed to oxen gets stored in a <a href="https://en.wikipedia.org/wiki/Content-addressable_storage">Content Addressable File System</a> in the <code>.oxen/versions</code> directory. Oxen first computes a <a href="domains/optimizations/hashing.html">hash of the file</a>, then stores the file in a sub directory that mirrors the hash. This means that the file can be retrieved by its hash at any time.</p>
<pre><code class="language-bash">$ tree .oxen/versions

.oxen/versions
‚îî‚îÄ‚îÄ files
    ‚îú‚îÄ‚îÄ 18
    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ 066113d946cfa640ffc8773c83f61b
    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ data.txt
    ‚îî‚îÄ‚îÄ a7
        ‚îî‚îÄ‚îÄ 666c8f5aaf946ca629d9d20c29aa6a
            ‚îî‚îÄ‚îÄ data.txt

6 directories, 2 files
</code></pre>
<p>Currently the files in Oxen are uncompressed in the versions directory, so you can simply <code>cat</code> the file to see the contents.</p>
<p>Note: We have compression in our list of <a href="domains/improvements.html">improvements</a> that could be made to the system.</p>
<pre><code class="language-bash">$ cat .oxen/versions/files/a7/666c8f5aaf946ca629d9d20c29aa6a/data.txt

Hello
</code></pre>
<p>Let's change the <code>hello.txt</code> file and commit it again.</p>
<pre><code class="language-bash">$ echo "Hello, World!" &gt; hello.txt
$ oxen add hello.txt
$ oxen commit -m "Update hello.txt"
</code></pre>
<p>Now look at the <code>.oxen/versions</code> directory. You will see that we have a new hashed directory for the file. This means that the file has been updated and a new snapshot has been created.</p>
<pre><code class="language-bash">$ tree .oxen/versions

.oxen/versions
‚îî‚îÄ‚îÄ files
    ‚îú‚îÄ‚îÄ 18
    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ 066113d946cfa640ffc8773c83f61b
    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ data.txt
    ‚îú‚îÄ‚îÄ a7
    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ 666c8f5aaf946ca629d9d20c29aa6a
    ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ data.txt
    ‚îî‚îÄ‚îÄ ce
        ‚îî‚îÄ‚îÄ 1931b6136c7ad3e2a42fb0521986ba
            ‚îî‚îÄ‚îÄ data.txt

8 directories, 3 files
</code></pre>
<p>Let's look at each individual file in the versions dir.</p>
<pre><code class="language-bash">$ cat .oxen/versions/files/a7/666c8f5aaf946ca629d9d20c29aa6a/data.txt
Hello

$ cat .oxen/versions/files/18/066113d946cfa640ffc8773c83f61b/data.txt
World

$ cat .oxen/versions/files/ce/1931b6136c7ad3e2a42fb0521986ba/data.txt
Hello, World!
</code></pre>
<p>This doesn't give you the full picture of how Oxen works, but it hopefully gives you a starting point into the Content Addressable File System that Oxen uses to store all versions of the files. We will get into the details of the other databases as we dive into other domains and commands.</p>
<h2 id="localrepository"><a class="header" href="#localrepository">LocalRepository</a></h2>
<p>Since all of the data for all of the versions is simply stored in a hidden subdirectory, the first object we introduce is the <code>LocalRepository</code>. This object simply represents the <code>path</code> to the repository so that we know where to look for subsequent objects.</p>
<p><a href="https://github.com/Oxen-AI/Oxen/blob/main/src/lib/src/model/repository/local_repository.rs">src/lib/src/model/repository/local_repository.rs</a></p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct LocalRepository {
    pub path: PathBuf,
    // Optional remotes to sync the data to
    remote_name: Option&lt;String&gt;,
    pub remotes: Vec&lt;Remote&gt;,
}
<span class="boring">}</span></code></pre></pre>
<p>Whenever starting down a code path within the CLI the first thing we do is find where the <code>.oxen</code> directory is and instantiate our <code>LocalRepository</code> object.</p>
<p>There is a handy helper method to get a repo from the current dir. This recursively traverses up in the directory structure to find a <code>.oxen</code> directory and instantiates the <code>LocalRepository</code> object.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let repository = LocalRepository::from_current_dir()?;
<span class="boring">}</span></code></pre></pre>
<p>You may want to reference the code for the <a href="https://github.com/Oxen-AI/Oxen/blob/main/src/cli/src/cmd/add.rs">add</a> command to see how instantiating a <code>LocalRepository</code> works in practice.</p>
<p>You will notice that not only does a <code>LocalRepository</code> have a <code>path</code>, but it also has a <code>remote_name</code> and <code>remotes</code>. These are read from <code>.oxen/config.toml</code> and tell inform Oxen where to sync the data to.</p>
<h1 id="remotes"><a class="header" href="#remotes">Remotes</a></h1>
<p>A remote in the context of Oxen is simply a name and a url. The name is a human readable representation and the url is the actual location of the remote repository.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Remote {
    pub name: String,
    pub url: String,
}
<span class="boring">}</span></code></pre></pre>
<p>The remotes can be set through the <code>oxen config</code> command.</p>
<pre><code class="language-bash">oxen config --set-remote origin http://localhost:3001/my-namespace/my-repo
</code></pre>
<p>If you look in the <code>.oxen/config.toml</code> file you will see the remotes listed there.</p>
<pre><code class="language-toml">remote_name = "origin"

[[remotes]]
name = "origin"
url = "http://localhost:3001/my-namespace/my-repo"
</code></pre>
<p>You can have multiple remotes as well as a default remote specified by <code>remote_name</code>. The default remote is the remote that will be used when you run <code>oxen push</code> or <code>oxen pull</code> without specifying a remote.</p>
<h2 id="remoterepository"><a class="header" href="#remoterepository">RemoteRepository</a></h2>
<p>On the other end of the <code>LocalRepository</code> is the <code>RemoteRepository</code>. This object represents the remote repository that the <code>LocalRepository</code> is connected to. It has the same <code>url</code> as the <code>Remote</code> object.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct RemoteRepository {
    pub namespace: String,
    pub name: String,
    pub remote: Remote,
}
<span class="boring">}</span></code></pre></pre>
<p>All repositories that are stored on the <code>oxen-server</code> have a <code>namespace</code> and <code>name</code>. This helps us organize the repositories on disk, as well as in a way that is meaningful to the user.</p>
<p>In order to create a <code>RemoteRepository</code> we will first need to spin up an <code>oxen-server</code> instance. From your debug build you can do something like the following.</p>
<pre><code class="language-bash">export SYNC_DIR=/path/to/sync/dir
./target/debug/oxen-server start
</code></pre>
<p>This will start a server on the default host 0.0.0.0 and port 3000. The environment variable <code>SYNC_DIR</code> tells the server where to write the data to on disk.</p>
<p>Then we can use the <code>oxen create-remote</code> command from the CLI.</p>
<pre><code class="language-bash">oxen create-remote --name my-namespace/my-repo --host 0.0.0.0:3000 --scheme http
</code></pre>
<p>If you look in the <code>SYNC_DIR</code> you will see a directory structure that mirrors the namespace/repo-name of the repository you just created. There will be a <code>.oxen</code> directory with the remote repository created for you as well.</p>
<pre><code class="language-bash">ls -trla /path/to/sync/dir/my-namespace/my-repo/.oxen
</code></pre>
<p>What's cool is that on disk the <code>RemoteRepository</code> is the same structure as the <code>LocalRepository</code>. This means that we can use the same code to manipulate the <code>RemoteRepository</code> on the server as we can the <code>LocalRepository</code> on the client.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="commits"><a class="header" href="#commits">Commits</a></h1>
<p>If you are familiar with <code>git</code> the concept of a <code>commit</code> and <code>branch</code> should be very familiar. What you may not have done is look under the hood as to how they are stored. In Oxen, many of the concepts are similar.</p>
<p>A commit is a checksum or hash value representing all the files is within a specific version. You may recognize them as a string of hexidecimal characters  (0‚Äì9 and a‚Äìf) looking something like <code>4b27c4b16fb736a4</code>.</p>
<p>Run <code>oxen log</code> within your Oxen repository and you will see the initial commit.</p>
<pre><code>commit 4b27c4b16fb736a4

Author: ox
Date:   Thursday, 09 May 2024 22:29:00 +00

    Initialized Repo üêÇ
</code></pre>
<p>You will see these hashes all over the place in Oxen and can use them as pointers to get to specific versions.</p>
<p>To learn more about commits under the hood feel free to hop forward to <a href="domains/./domains/commits.html">learn about commits</a></p>
<h1 id="configtoml"><a class="header" href="#configtoml">Config.toml</a></h1>
<p>TODO:</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user"><a class="header" href="#user">User</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="remotes-1"><a class="header" href="#remotes-1">Remotes</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="commands-1"><a class="header" href="#commands-1">Commands</a></h1>
<p>The core commands in commands in Oxen map to git so that it is an easy learning curve to get started.</p>
<pre><code class="language-bash">oxen init
oxen add images/
oxen status
oxen commit -m "adding images"
oxen push origin main
</code></pre>
<p>Join us as we break down each command step by step, as if you were building it from scratch.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="init"><a class="header" href="#init">init</a></h1>
<p><code>oxen init</code></p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="clone"><a class="header" href="#clone">clone</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="data-types"><a class="header" href="#data-types">Data Types</a></h1>
<p>There are core data types that Oxen detects and can do special processing with. This helps increase visibility into your data, and makes it extensible to your use case.</p>
<ul>
<li>Text</li>
<li>Image</li>
<li>Audio</li>
<li>Video</li>
<li>Tabular</li>
<li>Blob</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="optimizations"><a class="header" href="#optimizations">Optimizations</a></h1>
<p>There are many optimizations that make Oxen go brrr. From the core merkle tree structure, to hashing protocol, to networking, to interacting with remote datasets. Oxen is meant to make it feel like you have terrabytes of data at your fingertips whatever machine you are on.</p>
<h1 id="tldrs"><a class="header" href="#tldrs"><del>TLDRs</del></a></h1>
<p>We often get asked: "What makes Oxen different from other VCS?"</p>
<p>Without diving into the gnitty gritty details, here are some highlights. If you want to go deeper, don't worry, we also dive deep into the implementation details of each throughout the book.</p>
<h2 id="merkle-tree"><a class="header" href="#merkle-tree">Merkle Tree</a></h2>
<ul>
<li>Downloading Sub Trees</li>
<li>Per Folder Sub Trees</li>
<li>Block Level Dedup</li>
<li>Only download latest</li>
<li>Push / Pull Bottle Neck</li>
<li>Objects
<ul>
<li>Trees</li>
<li>VNodes</li>
<li>Blobs</li>
<li>Schemas</li>
</ul>
</li>
</ul>
<h2 id="hashing"><a class="header" href="#hashing">Hashing</a></h2>
<ul>
<li>xxHash</li>
<li>pure hashing throughput</li>
<li>non-cryptographic hashing fn</li>
</ul>
<h2 id="compression"><a class="header" href="#compression">Compression</a></h2>
<ul>
<li>Block level dedup</li>
<li>zlib</li>
</ul>
<h2 id="concurrency"><a class="header" href="#concurrency">Concurrency</a></h2>
<ul>
<li>Fearless concurrency</li>
<li>Hashing data</li>
<li>Moooooving data over the network</li>
<li>Moooooving data on disk</li>
</ul>
<h2 id="networking"><a class="header" href="#networking">Networking</a></h2>
<ul>
<li>Smart Chunking</li>
</ul>
<h2 id="remote-workspaces"><a class="header" href="#remote-workspaces">Remote Workspaces</a></h2>
<ul>
<li>oxen remote add</li>
<li>oxen remote commit</li>
<li>oxen remote df</li>
<li>oxen remote ls</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="merkle-tree-1"><a class="header" href="#merkle-tree-1">Merkle Tree</a></h1>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="hashing-1"><a class="header" href="#hashing-1">Hashing</a></h1>
<p>One of the optimizations within Oxen is to use the <a href="https://github.com/Cyan4973/xxHash">xxHash algorithm</a> to hash the file contents. This is a very fast hashing algorithm that is designed to be very memory efficient. It is also very fast to compute.</p>
<p>Compared to SHA or MD5 hashes which can hash data at &lt; 1GB/s, xxHash can hash data at 30GB/s. This is a significant improvement for large files, and speeds up the process of adding and committing files to Oxen.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compression-1"><a class="header" href="#compression-1">Compression</a></h1>
<p>TODO: Block level deduplication can be turned on in order to shrink older datasets. It comes at a reconstruction cost of the data, so can be turned on and off depending on your use case.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="storage"><a class="header" href="#storage">Storage</a></h1>
<p>TODO: Support different storage backends</p>
<ul>
<li>Local SSDs</li>
<li>NFS</li>
<li>S3</li>
<li>FSpec</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
