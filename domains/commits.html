<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Commits - Oxen</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../init.html">üêÇ üåæ Oxen.ai</a></li><li class="chapter-item expanded "><a href="../development.html"><strong aria-hidden="true">1.</strong> Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../development/installation.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../development/build_and_run.html"><strong aria-hidden="true">1.2.</strong> Build & Run</a></li><li class="chapter-item expanded "><a href="../development/add_command.html"><strong aria-hidden="true">1.3.</strong> Adding a Command</a></li><li class="chapter-item expanded "><a href="../development/testing.html"><strong aria-hidden="true">1.4.</strong> Testing</a></li><li class="chapter-item expanded "><a href="../development/release.html"><strong aria-hidden="true">1.5.</strong> Release</a></li></ol></li><li class="chapter-item expanded "><a href="../domains.html"><strong aria-hidden="true">2.</strong> Domains</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../domains/repositories.html"><strong aria-hidden="true">2.1.</strong> Repositories</a></li><li class="chapter-item expanded "><a href="../domains/commits.html" class="active"><strong aria-hidden="true">2.2.</strong> Commits</a></li><li class="chapter-item expanded "><a href="../domains/branches.html"><strong aria-hidden="true">2.3.</strong> Branches</a></li><li class="chapter-item expanded "><a href="../domains/merkle_trees.html"><strong aria-hidden="true">2.4.</strong> Merkle Trees</a></li><li class="chapter-item expanded "><a href="../domains/data_frames.html"><strong aria-hidden="true">2.5.</strong> Data Frames</a></li><li class="chapter-item expanded "><a href="../domains/schemas.html"><strong aria-hidden="true">2.6.</strong> Schemas</a></li><li class="chapter-item expanded "><a href="../domains/diffs.html"><strong aria-hidden="true">2.7.</strong> Diffs</a></li></ol></li><li class="chapter-item expanded "><a href="../commands.html"><strong aria-hidden="true">3.</strong> Commands</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/init.html"><strong aria-hidden="true">3.1.</strong> init</a></li><li class="chapter-item expanded "><a href="../commands/config.html"><strong aria-hidden="true">3.2.</strong> config</a></li><li class="chapter-item expanded "><a href="../commands/add.html"><strong aria-hidden="true">3.3.</strong> add</a></li><li class="chapter-item expanded "><a href="../commands/status.html"><strong aria-hidden="true">3.4.</strong> status</a></li><li class="chapter-item expanded "><a href="../commands/commit.html"><strong aria-hidden="true">3.5.</strong> commit</a></li><li class="chapter-item expanded "><a href="../commands/checkout.html"><strong aria-hidden="true">3.6.</strong> checkout</a></li><li class="chapter-item expanded "><a href="../commands/push.html"><strong aria-hidden="true">3.7.</strong> push</a></li><li class="chapter-item expanded "><a href="../commands/clone.html"><strong aria-hidden="true">3.8.</strong> clone</a></li><li class="chapter-item expanded "><a href="../commands/pull.html"><strong aria-hidden="true">3.9.</strong> pull</a></li></ol></li><li class="chapter-item expanded "><a href="../data_types.html"><strong aria-hidden="true">4.</strong> Data Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../data_types/text.html"><strong aria-hidden="true">4.1.</strong> Text</a></li><li class="chapter-item expanded "><a href="../data_types/image.html"><strong aria-hidden="true">4.2.</strong> Image</a></li><li class="chapter-item expanded "><a href="../data_types/audio.html"><strong aria-hidden="true">4.3.</strong> Audio</a></li><li class="chapter-item expanded "><a href="../data_types/video.html"><strong aria-hidden="true">4.4.</strong> Video</a></li><li class="chapter-item expanded "><a href="../data_types/tabular.html"><strong aria-hidden="true">4.5.</strong> Tabular</a></li><li class="chapter-item expanded "><a href="../data_types/binary.html"><strong aria-hidden="true">4.6.</strong> Binary</a></li></ol></li><li class="chapter-item expanded "><a href="../optimizations.html"><strong aria-hidden="true">5.</strong> Optimizations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../optimizations/merkle_tree.html"><strong aria-hidden="true">5.1.</strong> Merkle Tree</a></li><li class="chapter-item expanded "><a href="../optimizations/concurrency.html"><strong aria-hidden="true">5.2.</strong> Concurrency</a></li><li class="chapter-item expanded "><a href="../optimizations/hashing.html"><strong aria-hidden="true">5.3.</strong> Hashing</a></li><li class="chapter-item expanded "><a href="../optimizations/compression.html"><strong aria-hidden="true">5.4.</strong> Compression</a></li><li class="chapter-item expanded "><a href="../optimizations/networking.html"><strong aria-hidden="true">5.5.</strong> Networking</a></li><li class="chapter-item expanded "><a href="../optimizations/remote_workspace.html"><strong aria-hidden="true">5.6.</strong> Remote Workspace</a></li><li class="chapter-item expanded "><a href="../optimizations/storage.html"><strong aria-hidden="true">5.7.</strong> Storage</a></li><li class="chapter-item expanded "><a href="../optimizations/why_not_git.html"><strong aria-hidden="true">5.8.</strong> Why not extend Git?</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Oxen</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="commits"><a class="header" href="#commits">Commits</a></h1>
<p>If you are familiar with <code>git</code> the concept of a <code>commit</code> and <code>branch</code> should be very familiar. What you may not have done is look under the hood as to how they are stored. In Oxen, many of the concepts are similar.</p>
<p>A commit is a checksum or <a href="optimizations/hashing.html">hash value</a> representing all the files is within a specific version. You may recognize them as a string of hexadecimal characters  (0‚Äì9 and a‚Äìf) looking something like <code>4b27c4b16fb736a4</code>.</p>
<p>Run <code>oxen log</code> within your Oxen repository and you will see the initial commit.</p>
<pre><code>commit 4b27c4b16fb736a4

Author: ox
Date:   Thursday, 09 May 2024 22:29:00 +00

    Initialized Repo üêÇ
</code></pre>
<p>You will see these hashes all over the place in Oxen and can use them as pointers to get to specific versions.</p>
<h1 id="commits-database"><a class="header" href="#commits-database">Commits Database</a></h1>
<p>In order to understand the Commit object better, let's look at how it is stored on disk. Again we are going to peek in the <code>.oxen</code> directory as our starting point. Specifically at the <code>commits</code> directory.</p>
<pre><code>$ ls .oxen/commits

000008.sst       000014.log       IDENTITY         LOG              OPTIONS-000012
000013.sst       CURRENT          LOCK             MANIFEST-000015  OPTIONS-000017
</code></pre>
<p>This entire directory is the commits database. Under the hood Oxen stores most of it's data with <a href="https://rocksdb.org/">RocksDB</a>. This is a fast key-value store that makes it fast to insert and read data without loading the entire database into memory. Specifically we use the rust bindings for RocksDB found in <a href="https://docs.rs/rocksdb/latest/rocksdb/">this repository</a>.</p>
<p>These files are hard to inspect on their own, so we can use the <code>oxen db</code> command to inspect the commits database. The <code>oxen db list</code> command will print out all the commits in the database.</p>
<pre><code>$ oxen db list .oxen/commits
</code></pre>
<p>You'll see this prints the entire key value store as tab separated values.</p>
<pre><code>2c610ae8e424a4c8	{"id":"2c610ae8e424a4c8","parent_ids":["440b54a690b44fd7"],"message":"Add hello.txt and world.txt","author":"oxbot","email":"oxbot@oxen.ai","root_hash":"cf2c5e5f057b589230654260d07fa7c3","timestamp":"2024-05-23T00:40:20.555747Z"}
440b54a690b44fd7	{"id":"440b54a690b44fd7","parent_ids":[],"message":"Initialized Repo üêÇ","author":"oxbot","email":"oxbot@oxen.ai","root_hash":"99aa06d3014798d86001c324468d497f","timestamp":"2024-05-23T00:40:02.047406Z"}
a36e6239a1ab49d4	{"id":"a36e6239a1ab49d4","parent_ids":["2c610ae8e424a4c8"],"message":"Update hello.txt","author":"oxbot","email":"oxbot@oxen.ai","root_hash":"7121f5302a90ea338f129ca169a39739","timestamp":"2024-05-23T00:43:53.303893Z"}
</code></pre>
<p>If you want to get a specific commit, you can use the <code>oxen db get</code> command. For example, to get the commit <code>2c610ae8e424a4c8</code>, you can run the following command.</p>
<pre><code>$ oxen db get .oxen/commits/ 2c610ae8e424a4c8 | jq
</code></pre>
<pre><code>{
  "id": "2c610ae8e424a4c8",
  "parent_ids": [
    "440b54a690b44fd7"
  ],
  "message": "Add hello.txt and world.txt",
  "author": "oxbot",
  "email": "oxbot@oxen.ai",
  "timestamp": "2024-05-23T00:40:20.555747Z"
}
</code></pre>
<p>Ah, there is a nice beautiful commit object. You can see that the raw values are simply stored in the db as json. There is a list of parent commit ids, a message, the author, the email, and the timestamp.</p>
<h1 id="commit-metadata"><a class="header" href="#commit-metadata">Commit Metadata</a></h1>
<p>All of the metadata within a commit object is important for computing it's <code>id</code>. The id can be used to verify the integrity of the data within a commit. More on this later.</p>
<p>The first piece of metadata is the user that made the commit. The user data is read from the global <code>~/.config/oxen/user_config.toml</code> file. You can set your user info with the <code>oxen config</code> command.</p>
<pre><code class="language-bash">$ oxen config --name 'Bessie' --email 'bessie@your_email.com'
</code></pre>
<pre><code class="language-bash">$ cat ~/.config/oxen/user_config.toml
</code></pre>
<pre><code>name = "Bessie"
email = "bessie@your_email.com"
</code></pre>
<p>It also contains the timestamp of the commit, and a user provided message. All of these pieces of data are used in computing the commit id, which is a unique representation of the data in this commit.</p>
<h1 id="commit-id-hash"><a class="header" href="#commit-id-hash">Commit Id (Hash)</a></h1>
<p>Each commit has a unique id (hash) that can be verified to ensure the integrity of the data in this commit. It is a combination of the data within all the files of the commit, the user data, timestamp, and the message.</p>
<p>What's nice about this is that once the data has been synced to the remote server, we can verify that the data is valid by computing the hashes of the files and the commit data and comparing this to the id of the commit in the database.</p>
<h1 id="commit-history"><a class="header" href="#commit-history">Commit History</a></h1>
<p>Every commit (except the first) has a list of parent commit ids. Most commits have a single parent, but in the case of a merge commit, there can be multiple parent commit ids. You can traverse the commit history by following the parent commit ids until you hit the first commit.</p>
<p>You can use the <code>oxen log</code> command to print out the commit history starting with the most recent commit on the current branch.</p>
<h2 id="next-up-branches"><a class="header" href="#next-up-branches">Next Up: Branches</a></h2>
<p>Learn how commits relate to <a href="./branches.html">Branches</a> in the next section.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../domains/repositories.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../domains/branches.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../domains/repositories.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../domains/branches.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
